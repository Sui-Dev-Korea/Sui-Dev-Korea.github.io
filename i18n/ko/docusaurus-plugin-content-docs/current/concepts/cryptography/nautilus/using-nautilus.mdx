---
title: Using Nautilus
description: ì¬í˜„ ê°€ëŠ¥í•œ ë¹Œë“œ í…œí”Œë¦¿ê³¼ í•¨ê»˜ Nautilusë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì„¸ë¶€ì‚¬í•­ì´ë‹¤.
---

[Nautilus í”„ë ˆì„ì›Œí¬](https://github.com/MystenLabs/nautilus) ëŠ” ì¬í˜„ ê°€ëŠ¥í•œ ë¹Œë“œ, ì„œëª… í¬ë§·íŒ…, HTTPS íŠ¸ë˜í”½ í¬ì›Œë”©ê³¼ ê°™ì€ ìŠ¤ìºí´ë”©ì„ í†µí•´ AWS Nitro Enclave ë°°í¬ë¥¼ ë•ëŠ”ë‹¤. ì´ëŠ” enclave ë‚´ë¶€ì˜ ì˜¤í”„ì²´ì¸ ê³„ì‚° ë¡œì§ êµ¬í˜„ì— ì§‘ì¤‘í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

ì´ í”„ë ˆì„ì›Œí¬ëŠ” Nautilus ì¸ìŠ¤í„´ìŠ¤ì™€ í•´ë‹¹ ê³µê°œ í‚¤ë¥¼ ë“±ë¡í•˜ëŠ” ë° í•„ìš”í•œ ìµœì†Œ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì½”ë“œê°€ í¬í•¨ëœ ì˜¨ì²´ì¸ í…œí”Œë¦¿ë„ ì œê³µí•œë‹¤.<br>dAppì—ì„œ Nautilusë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤:

1. ì›í•˜ëŠ” ê³„ì‚° ë¡œì§ìœ¼ë¡œ Rustë¡œ enclaveë¥¼ êµ¬í˜„í•œë‹¤.
2. ì˜ˆìƒ í”Œë«í¼ êµ¬ì„± ë ˆì§€ìŠ¤í„°(PCRs)ë¥¼ ì €ì¥í•˜ê³  ì»¨íŠ¸ë™íŠ¸ ë°°í¬ìê°€ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” Move ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ë°°í¬í•œë‹¤.
3. AWSì— enclave ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°°í¬í•˜ê³  í•´ë‹¹ attestation ë¬¸ì„œë¥¼ ì‚¬ìš©í•´ ì˜¨ì²´ì¸ì— ë“±ë¡í•œë‹¤.
4. ë“±ë¡ëœ enclaveì—ì„œ ì„œëª…ëœ ì‘ë‹µì„ ì—…ë¡œë“œí•˜ê³  ì´ë¥¼ ì˜¨ì²´ì¸ì—ì„œ ê²€ì¦í•œ ë‹¤ìŒ, ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ì—ì„œ ê²°ê³¼ë¥¼ ì‚¬ìš©í•œë‹¤.

## Purpose of this guide

ì´ ê°€ì´ë“œëŠ” ë‹¤ìŒ ë‹¨ê³„ë¥¼ ì•ˆë‚´í•œë‹¤:

1. AWS Nitro Enclavesë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ Nautilus ì˜¤í”„ì²´ì¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‘ì„±í•˜ê³  ë°°í¬í•œë‹¤. ì˜ˆì œ ì¸ìŠ¤í„´ìŠ¤ëŠ” íŠ¹ì • ìœ„ì¹˜ì˜ ë‚ ì”¨ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì„œë²„ë¥¼ ì‹¤í–‰í•œë‹¤.
2. Attestationê³¼ public keyë¥¼ ê²€ì¦í•˜ì—¬ enclaveë¥¼ ë“±ë¡í•˜ê³ , ì˜¨ì²´ì¸ì—ì„œ Nautilus ì‘ë‹µ(ì„œëª…ê³¼ í˜ì´ë¡œë“œ)ì„ ê²€ì¦í•œ ë‹¤ìŒ ìœ„ì¹˜ì™€ ì˜¨ë„ ë°ì´í„°ë¡œ NFTë¥¼ ë¯¼íŠ¸í•˜ëŠ” Move ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ë¥¼ ì‘ì„±í•œë‹¤.

ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤:

- ì‚¬ì „ êµ¬ì„±ëœ EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹œì‘í•˜ê³  Nitro Enclaveë¥¼ í• ë‹¹í•œë‹¤.
- Rust ê¸°ë°˜ í…œí”Œë¦¿ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ enclave image format(EIF) ë°”ì´ë„ˆë¦¬ë¡œ ë¹Œë“œí•˜ê³  enclave ë‚´ë¶€ì—ì„œ ì‹¤í–‰í•œë‹¤.
- Enclave ìì²´ëŠ” ì¸í„°ë„·ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ìƒìœ„ EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ í†µí•´ ì™¸ë¶€ APIì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•„ìš”í•œ HTTP ë„ë©”ì¸ì„ êµ¬ì„±í•œë‹¤.
- í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ enclaveì™€ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ ì„¸ ê°œì˜ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë…¸ì¶œí•œë‹¤.

Enclaveê°€ ì‹œì‘ë˜ë©´ ìƒˆë¡œìš´ í‚¤ ìŒì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë…¸ì¶œí•œë‹¤:

- `health_check`: Enclave ë‚´ë¶€ì—ì„œ í—ˆìš©ëœ ë„ë©”ì¸ì„ ì ê²€í•œë‹¤. ì´ ë¡œì§ì€ í…œí”Œë¦¿ì— ë‚´ì¥ë˜ì–´ ìˆìœ¼ë©° ìˆ˜ì •ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤.
- `get_attestation`: Enclaveì˜ public keyì— ëŒ€í•œ ì„œëª…ëœ attestation ë¬¸ì„œë¥¼ ë°˜í™˜í•œë‹¤. ì˜¨ì²´ì¸ ë“±ë¡ ì‹œ ì‚¬ìš©í•œë‹¤. ì´ ë¡œì§ì€ í…œí”Œë¦¿ì— ë‚´ì¥ë˜ì–´ ìˆìœ¼ë©° ìˆ˜ì •ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤.
- `process_data`: ì™¸ë¶€ APIì—ì„œ ë‚ ì”¨ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  enclave í‚¤ë¡œ ì„œëª…í•œ ë’¤ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤. ì´ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ê°€ëŠ¥í•œ ë¡œì§ì€ ì‚¬ìš©ìê°€ êµ¬í˜„í•´ì•¼ í•œë‹¤.

## Code structure

ìµœì‹  êµ¬ì¡°ì™€ ê´€ë ¨ ì§€ì¹¨ì€ [GitHub repository](https://github.com/MystenLabs/nautilus)ë¥¼ ì°¸ì¡°í•œë‹¤.

```sh
/move
  /enclave          # Enclave êµ¬ì„± ë° public key ë“±ë¡ì„ ìœ„í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
  /weather-example  # Enclave í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜¨ì²´ì¸ ë¡œì§ ì˜ˆì œ
  /twitter-example  # ëŒ€ì²´ ì˜¨ì²´ì¸ ë¡œì§ ì˜ˆì œ

/src
  /aws              # AWS ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ë¡œ, ìˆ˜ì •ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤.
  /init             # AWS ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ë¡œ, ìˆ˜ì •ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤.
  /system           # AWS ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ë¡œ, ìˆ˜ì •ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤.
  /nautilus-server  # Enclave ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ëŠ” Nautilus ì„œë²„.
    /src
      /apps
        /weather-example    # ì˜ˆì œ ë””ë ‰í„°ë¦¬ë¡œ, í•„ìš”ì— ë”°ë¼ ìì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ìœ¼ë¡œ êµì²´í•œë‹¤.
          mod.rs            # process_data ì—”ë“œí¬ì¸íŠ¸ì™€ ê´€ë ¨ ë¡œì§ì„ ì •ì˜í•œë‹¤. ì˜¤í”„ì²´ì¸ ê³„ì‚° ë¡œì§ìœ¼ë¡œ êµì²´í•œë‹¤.
          allowed_endpoints.yaml  # Enclaveê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë‚˜ì—´í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ enclaveëŠ” ì¸í„°ë„· ì ‘ê·¼ ê¶Œí•œì´ ì—†ë‹¤. êµ¬ì„± ì¤‘ ì´ íŒŒì¼ì€ íŠ¸ë˜í”½ í¬ì›Œë”©ì„ ìœ„í•œ ì½”ë“œë¥¼ ìƒì„±í•œë‹¤.
        /twitter-example    # ìœ ì‚¬í•œ êµ¬ì¡°ì˜ ë˜ ë‹¤ë¥¸ ì˜ˆì œ ë””ë ‰í„°ë¦¬.
    run.sh           # Enclave ë‚´ë¶€ì—ì„œ Rust ì„œë²„ë¥¼ ì‹¤í–‰í•œë‹¤. ìˆ˜ì •í•˜ì§€ ì•ŠëŠ”ë‹¤.
    common.rs        # Attestationì„ ê°€ì ¸ì˜¤ëŠ” ê³µí†µ ì½”ë“œì´ë‹¤. ìˆ˜ì •í•˜ì§€ ì•ŠëŠ”ë‹¤.
```

í•µì‹¬ êµ¬í˜„ íŒŒì¼:

- `allowed_endpoints.yaml`: ì™¸ë¶€ API ì ‘ê·¼ ê¶Œí•œì„ ì •ì˜í•œë‹¤.
- `mod.rs`: ì• í”Œë¦¬ì¼€ì´ì…˜ë³„ ê³„ì‚° ë¡œì§ì„ í¬í•¨í•œë‹¤.
- `run.sh`: ì„œë²„ ì‹œì‘ê³¼ êµ¬ì„±ì„ ì²˜ë¦¬í•œë‹¤.
- `common.rs`: attestation ê°€ì ¸ì˜¤ê¸°ë¥¼ ê´€ë¦¬í•œë‹¤.

ìì‹ ë§Œì˜ Nautilus ì•±ì„ ë§Œë“¤ë ¤ë©´:

- Move ëª¨ë“ˆìš© ë””ë ‰í„°ë¦¬ë¥¼ `move/my_app` ì•„ë˜ì— ì¶”ê°€í•œë‹¤.
- Rust ì„œë²„ ë¡œì§ìš© ë””ë ‰í„°ë¦¬ë¥¼ `src/nautilus-server/src/apps/my_app` ì•„ë˜ì— ì¶”ê°€í•œë‹¤.
- ê¸°ì¡´ ì•± ë””ë ‰í„°ë¦¬ë¥¼ ì°¸ê³ í•œë‹¤.
- ë°°í¬ëœ Move ì»¨íŠ¸ë™íŠ¸ì™€ enclaveì—ì„œ í˜¸ìŠ¤íŒ…ë˜ëŠ” Rust ì„œë²„ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” í”„ëŸ°íŠ¸ì—”ë“œ ë¡œì§ì„ êµ¬ì¶•í•œë‹¤.

í…œí”Œë¦¿ì˜ ëŒ€ë¶€ë¶„ì€ ìˆ˜ì • ì—†ì´ ìœ ì§€í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì•±ë³„ ë¡œì§ì— ëŒ€í•œ ì™„ì „í•œ ì œì–´ë¥¼ ìœ ì§€í•˜ë©´ì„œ ê°œë°œì„ ê°„ì†Œí™”í•  ìˆ˜ ìˆë‹¤.

:::info Frontend ì½”ë“œëŠ” ì´ ê°€ì´ë“œì— í¬í•¨ë˜ì–´ ìˆì§€ ì•Šë‹¤. Move í˜¸ì¶œì€ CLIë¥¼ ì‚¬ìš©í•´ ì‹œì—°í•œë‹¤. :::

## Run the example enclave

1. AWS ê°œë°œì ê³„ì •ì„ ì„¤ì •í•˜ê³  AWS CLIë¥¼ ì„¤ì¹˜í•œë‹¤. ìì„¸í•œ ì§€ì¹¨ì€  [AWS Nitro Enclaves getting started guide](https://docs.aws.amazon.com/enclaves/latest/user/getting-started.html#launch-instance)ë¥¼ ì°¸ì¡°í•œë‹¤.

2. ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  í”„ë¡¬í”„íŠ¸ë¥¼ ë”°ë¥¸ë‹¤. ìŠ¤í¬ë¦½íŠ¸ëŠ” ì¼ë¶€ ê°’ì„ ì…ë ¥í•˜ë„ë¡ ìš”ì²­í•œë‹¤-ì´ ì˜ˆì œë¥¼ ê·¸ëŒ€ë¡œ ì‹¤í–‰í•˜ë ¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ì°¸ì¡°í•œë‹¤. ìŠ¤í¬ë¦½íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ë¡œì»¬ì— ìƒì„±ëœ ì½”ë“œë¥¼ ì»¤ë°‹í•´ì•¼ í•œë‹¤. ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì´ì–´ì§€ëŠ” ì •ë³´ ìƒìë¥¼ ì°¸ì¡°í•˜ëŠ”ë°, AWS ê³„ì • ì„¤ì •ì— ë”°ë¼ ì§€ì¹¨ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤.

    ```sh
    $ export KEY_PAIR=<your-key-pair-name>
    $ export AWS_ACCESS_KEY_ID=<your-access-key>
    $ export AWS_SECRET_ACCESS_KEY=<your-secret-key>
    $ export AWS_SESSION_TOKEN=<your-session-token>
    $ sh configure_enclave.sh <APP> # ì˜ˆ: `sh configure_enclave.sh weather-example`
    ```

    :::info

    - ì¶”ê°€ ì§€ì¹¨ì€ `sh configure_enclave.sh -h`ë¥¼ ì‹¤í–‰í•˜ì—¬ í™•ì¸í•œë‹¤.

    - AWS ê³„ì •ì´ `us-east-1`,ê°€ ì•„ë‹Œ ê²½ìš°, ì§€ì—­ë³„ë¡œ `REGION` ê³¼ `AMI_ID` ê°’ì„ êµ¬ì„±í•´ì•¼ í•  ìˆ˜ ìˆë‹¤. ì í•©í•œ Amazon Linux ì´ë¯¸ì§€ IDë¥¼ ì°¾ê¸° ìœ„í•´ ì´ [guide](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/finding-an-ami.html)ë¥¼ ì°¸ì¡°í•œë‹¤.

        ```sh
        $ export REGION=<your-region>
        $ export AMI_ID=<find-an-amazon-linux-ami-for-your-region>
        ```

    -  `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`,`AWS_SESSION_TOKEN`ì˜ ê°’ì„ ì°¾ìœ¼ë ¤ë©´ ì´ [AWS guide](https://docs.aws.amazon.com/streams/latest/dev/setting-up.html) ë¥¼ ì°¸ì¡°í•œë‹¤.

    - `KEY_PAIR` ëŠ” ê¸°ì¡´ AWS í‚¤ í˜ì–´ ì´ë¦„ ë˜ëŠ” ìƒì„±í•  í‚¤ í˜ì–´ ì´ë¦„ìœ¼ë¡œ ì„¤ì •í•œë‹¤. í‚¤ í˜ì–´ë¥¼ ìƒì„±í•˜ë ¤ë©´ ì´ [AWS guide](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/create-key-pairs.html)ë¥¼ ì°¸ì¡°í•œë‹¤.

    - ê³µê°œ ì„œë¸Œë„·ì´ ìˆëŠ” VPCë¥¼ ìƒì„±í•´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤. ì§€ì¹¨ì€ ì´ [AWS guide](https://000058.awsstudygroup.com/2-prerequiste/2.1-createec2/2.1.2-createpublicsubnet/) ë¥¼ ì°¸ì¡°í•œë‹¤.

    :::

3. ë‚ ì”¨ ì˜ˆì œë¥¼ ê·¸ëŒ€ë¡œ ì‹¤í–‰í•˜ë ¤ë©´ `allowed_endpoints.yaml`ì„ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ëŠ”ë°, ì´ë¯¸ `api.weatherapi.com`ì´ í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤. í”„ë¡¬í”„íŠ¸ì— ë”°ë¼ í•„ìš”í•œ ê°’ì„ ì…ë ¥í•œë‹¤. ì´ ë‹¨ê³„ëŠ” AWS Secrets Managerë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œí¬ë¦¿(API í‚¤)ì„ ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ì‹œì—°í•˜ë¯€ë¡œ, ê³µê°œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì— ì‹œí¬ë¦¿ì„ í¬í•¨í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

    ```sh
    Enter EC2 instance base name: weather # ì›í•˜ëŠ” ì•„ë¬´ ê°’ì´ë‚˜ ëœë‹¤
    Do you want to use a secret? (y/n): y
    Do you want to create a new secret or use an existing secret ARN? (new/existing): new
    Enter secret name: weather-api-key # ì›í•˜ëŠ” ì•„ë¬´ ê°’ì´ë‚˜ ëœë‹¤
    Enter secret value: 045a27812dbe456392913223221306 # ì´ëŠ” ì˜ˆì‹œ API í‚¤ì´ë©°, weatherapi.comì—ì„œ ë³¸ì¸ì˜ í‚¤ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤
    ```

    Twitter ì˜ˆì œì˜ ê²½ìš°, ì´ ì‹œí¬ë¦¿ ê°’ì€ Twitter Developer ê³„ì •ê³¼ ì—°ê²°ëœ API Bearer Tokenì„ ì˜ë¯¸í•œë‹¤.

4. ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ `/src/nautilus-server/run.sh` ì™€ `expose_enclave.sh`ì— ë³€ê²½ ì‚¬í•­ì´ ìƒì„±ëœë‹¤. Enclave ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•  ë•Œ í•„ìš”í•˜ë¯€ë¡œ ì´ ë³€ê²½ ì‚¬í•­ì„ ì»¤ë°‹í•œë‹¤.

    :::info

    - Enclaveê°€ ì¶”ê°€ ì™¸ë¶€ ë„ë©”ì¸ì— ì ‘ê·¼í•˜ë„ë¡ í—ˆìš©í•˜ë ¤ë©´ `allowed_endpoints.yaml` ì— ë„ë©”ì¸ì„ ì¶”ê°€í•œë‹¤. ì´ íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ë©´ ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡ì´ enclave ë¹Œë“œì— ì»´íŒŒì¼ë˜ë¯€ë¡œ ìƒˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ `configure_enclave.sh`ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•´ì•¼ í•œë‹¤.
    - ì½”ë“œë² ì´ìŠ¤ì— í¬í•¨í•˜ê³  ì‹¶ì§€ ì•Šì€ ë¯¼ê°í•œ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•´ ì‹œí¬ë¦¿ì„ ì„ íƒì ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆë‹¤. ì‹œí¬ë¦¿ì€ í™˜ê²½ ë³€ìˆ˜ë¡œ enclaveì— ì „ë‹¬ëœë‹¤. ìƒˆë¡œ ìƒì„±ëœ ì‹œí¬ë¦¿ì„ ê²€ì¦í•˜ê±°ë‚˜ ê¸°ì¡´ ARNì„ ì°¾ìœ¼ë ¤ë©´ [AWS Secrets Manager console](https://us-east-1.console.aws.amazon.com/secretsmanager/listsecrets?region=%3CREGION%3E)ì„ í™•ì¸í•œë‹¤.

    :::

5. ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•˜ì—¬ ì €ì¥ì†Œë¥¼ í´ë¡ í•œë‹¤. ìì„¸í•œ ì§€ì¹¨ì€ AWS ë¬¸ì„œì˜ [Connect to your Linux instance using SSH](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/connect-linux-inst-ssh.html#connect-linux-inst-sshClient)ë¥¼ ì°¸ì¡°í•œë‹¤.

6. ì´ì œ ì´ì „ ë‹¨ê³„ì—ì„œ ì»¤ë°‹í•œ íŒŒì¼ ë³€ê²½ ì‚¬í•­ì„ í¬í•¨í•˜ì—¬ ì„œë²„ ì½”ë“œê°€ ìˆëŠ” ë””ë ‰í„°ë¦¬ ì•ˆì— ìˆì–´ì•¼ í•œë‹¤. ë‹¤ìŒìœ¼ë¡œ enclave ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  ì‹¤í–‰í•œ ë’¤, í¬íŠ¸ 3000ì—ì„œ HTTP ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë…¸ì¶œí•œë‹¤.

    ```sh
    $ cd nautilus/
    $ make ENCLAVE_APP=<APP> && make run ## ì´ëŠ” enclaveë¥¼ ë¹Œë“œí•˜ê³  ì‹¤í–‰í•œë‹¤. ì˜ˆ: `make ENCLAVE_APP=weather-example`
    $ sh expose_enclave.sh # íŠ¸ë˜í”½ì„ ìœ„í•´ í¬íŠ¸ 3000ì„ ì¸í„°ë„·ìœ¼ë¡œ ë…¸ì¶œí•œë‹¤
    ```

    :::info

    `make run` ëŒ€ì‹  `make run-debug`ë¥¼ ì‚¬ìš©í•´ ë””ë²„ê·¸ ëª¨ë“œì—ì„œ enclaveë¥¼ ì‹¤í–‰í•œë‹¤. ì´ëŠ” í”„ë¡œë•ì…˜ ë¹Œë“œì™€ ë‹¬ë¦¬ ëª¨ë“  ë¡œê·¸ë¥¼ ì¶œë ¥í•œë‹¤. ë””ë²„ê·¸ ëª¨ë“œì—ì„œëŠ” PCR ê°’ì´ ëª¨ë‘ 0ì´ë©° í”„ë¡œë•ì…˜ ìš©ë„ë¡œ ìœ íš¨í•˜ì§€ ì•Šë‹¤.

    :::

7. ì¶•í•˜í•œë‹¤. ğŸ‰ ì´ì œ ì™¸ë¶€ì—ì„œ enclaveì™€ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆë‹¤. `PUBLIC_IP`ëŠ” AWS ì½˜ì†”ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

    ```sh
    $ curl -H 'Content-Type: application/json' -X GET http://<PUBLIC_IP>:3000/health_check
    $ curl -H 'Content-Type: application/json' -X GET http://<PUBLIC_IP>:3000/get_attestation
    $ curl -H 'Content-Type: application/json' -d '{"payload": { "location": "San Francisco"}}' -X POST http://<PUBLIC_IP>:3000/process_data
    ```

8. ì„ íƒì ìœ¼ë¡œ, EC2 ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ AWS Certificate Manager(ACM)ì˜ SSL/TLS ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë“œ ë°¸ëŸ°ì„œ(ALB)ë¥¼ ì„¤ì •í•˜ê³  Amazon Route 53ìœ¼ë¡œ DNS ë¼ìš°íŒ…ì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ACM User Guide](https://docs.aws.amazon.com/acm/latest/userguide/gs-acm-request-public.html)ì™€ [ALB Guide](https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html)ë¥¼ ì°¸ì¡°í•œë‹¤.

## Develop your own Nautilus server

Nautilus ì„œë²„ ë¡œì§ì€ `src/nautilus-server`ì— ìˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆí•˜ë ¤ë©´ `apps/weather-example` ë˜ëŠ” `apps/twitter-example`ì„ í…œí”Œë¦¿ìœ¼ë¡œ ì°¸ì¡°í•œë‹¤:

- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì ‘ê·¼í•´ì•¼ í•˜ëŠ” ì™¸ë¶€ ë„ë©”ì¸ì„ ì§€ì •í•˜ê¸° ìœ„í•´ `allowed_endpoints.yaml`ì„ ì •ì˜í•œë‹¤.
- `process_data` ë¡œì§ì„ ì •ì˜í•˜ê³  í•„ìš”í•œ ì¶”ê°€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•´ `mod.rs`ë¥¼ ìƒì„±í•œë‹¤.

ë‹¤ìŒ íŒŒì¼ì€ ì¼ë°˜ì ìœ¼ë¡œ ìˆ˜ì •ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤:

- `common.rs` ëŠ” `get_attestation` ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì²˜ë¦¬í•œë‹¤.
- `main.rs` ëŠ” ì„ì‹œ í‚¤ ìŒì„ ì´ˆê¸°í™”í•˜ê³  HTTP ì„œë²„ë¥¼ ì„¤ì •í•œë‹¤.

ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì€ ë¡œì»¬ì—ì„œ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ `get_attestation`ì—”ë“œí¬ì¸íŠ¸ëŠ” Nitro Secure Module(NSM) ë“œë¼ì´ë²„ì— ëŒ€í•œ ì ‘ê·¼ì´ í•„ìš”í•˜ë¯€ë¡œ ë¡œì»¬ì—ì„œëŠ” ë™ì‘í•˜ì§€ ì•Šìœ¼ë©°, ì´ëŠ” êµ¬ì„±ëœ EC2 ì¸ìŠ¤í„´ìŠ¤ ë‚´ë¶€ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ë•Œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” ì„¤ì • ë‹¨ê³„ì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ enclave ë‚´ë¶€ì—ì„œ ì„œë²„ê°€ ì‹¤í–‰ë  ë•Œ ì •ìƒ ë™ì‘í•œë‹¤.

ë¡œì»¬ì—ì„œ `process_data`  ì—”ë“œí¬ì¸íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ë‹¤ìŒì„ ì‹¤í–‰í•œë‹¤:

```sh
$ cd src/nautilus-server/
$ RUST_LOG=debug API_KEY=045a27812dbe456392913223221306 cargo run --features=weather-example --bin nautilus-server
$ curl -H 'Content-Type: application/json' -d '{"payload": { "location": "San Francisco"}}' -X POST http://localhost:3000/process_data
```

<details></details>

<summary>Output</summary>

```json
{
  "response":
    {
      "intent":0,
      "timestamp_ms":1744041600000,
      "data":
        {
          "location":"San Francisco",
          "temperature":13
        }
    },
  "signature":"b75d2d44c4a6b3c676fe087465c0e85206b101e21be6cda4c9ab2fd4ba5c0d8c623bf0166e274c5491a66001d254ce4c8c345b78411fdee7225111960cff250a"
}
```



### Troubleshooting

- **Traffic forwarder error:** ëŒ€ìƒ ë„ë©”ì¸ì´ ëª¨ë‘ `allowed_endpoints.yaml`.ì— ë‚˜ì—´ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤. ëª¨ë“  ë„ë©”ì¸ì— ëŒ€í•œ enclave ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•œë‹¤.

```sh
$ curl -H 'Content-Type: application/json' -X GET http://<PUBLIC_IP>:3000/health_check
```

<details></details>

<summary>Output</summary>

```json
{
  "pk":"f343dae1df7f2c4676612368e40bf42878e522349e4135c2caa52bc79f0fc6e2",
  "endpoints_status":
    {
      "api.weatherapi.com":true
    }
}
```



- **Docker is not running:** EC2 ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ì§ ì‹œì‘ ì¤‘ì¼ ìˆ˜ ìˆë‹¤. ì ì‹œ ê¸°ë‹¤ë¦° ë’¤ ë‹¤ì‹œ ì‹œë„í•œë‹¤.

- **Cannot connect to enclave:**ì´ëŠ” VSOCK í†µì‹  ë¬¸ì œì¼ ìˆ˜ ìˆë‹¤. Enclaveê°€ ì‹¤í–‰ ì¤‘ì´ë©°  `sh expose_enclave.sh`ë¡œ ì˜¬ë°”ë¥´ê²Œ ë…¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.

### Reset

```sh
$ cd nautilus/
$ sh reset_enclave.sh
```

ê·¸ëŸ° ë‹¤ìŒ ì´ë¯¸ì§€ ë¹Œë“œ ë‹¨ê³„ë¥¼ ë‹¤ì‹œ ìˆ˜í–‰í•œë‹¤.

## Build locally to check reproducibility

ë™ì¼í•œ ì†ŒìŠ¤ ì½”ë“œ(`/src`ì˜ ëª¨ë“  ê²ƒ)ì—ì„œ ë¹Œë“œëœ ëª¨ë“  enclaveëŠ” ì¬í˜„ ê°€ëŠ¥í•œ ë¹Œë“œë¥¼ í†µí•´ ë™ì¼í•œ PCRì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.<br>ì´ëŠ” ``run.sh``ì—ì„œ ìˆ˜í–‰ëœ íŠ¸ë˜í”½ í¬ì›Œë”© ë³€ê²½ ì‚¬í•­ë„ í¬í•¨í•œë‹¤(ë¸Œëœì¹˜ ``example-configuration`` ì°¸ì¡°).

```sh
$ cd nautilus/
$ make ENCLAVE_APP=weather-example
$ cat out/nitro.pcrs
```

<details></details>

<summary>Output</summary>

```sh
911c87d0abc8c9840a0810d57dfb718865f35dc42010a2d5b30e7840b03edeea83a26aad51593ade1e47ab6cced4653e PCR0
911c87d0abc8c9840a0810d57dfb718865f35dc42010a2d5b30e7840b03edeea83a26aad51593ade1e47ab6cced4653e PCR1
21b9efbc184807662e966d34f390821309eeac6802309798826296bf3e8bec7c10edb30948c90ba67310f7b964fc500a PCR2
```



```sh
# ì´í›„ enclave ë“±ë¡ ì‹œ ì‚¬ìš©í•  env varë¥¼ ì¶”ê°€í•œë‹¤.
$ PCR0=911c87d0abc8c9840a0810d57dfb718865f35dc42010a2d5b30e7840b03edeea83a26aad51593ade1e47ab6cced4653e
$ PCR1=911c87d0abc8c9840a0810d57dfb718865f35dc42010a2d5b30e7840b03edeea83a26aad51593ade1e47ab6cced4653e
$ PCR2=21b9efbc184807662e966d34f390821309eeac6802309798826296bf3e8bec7c10edb30948c90ba67310f7b964fc500a
```

## Register the enclave on chain

Rust ì½”ë“œë¥¼ ìµœì¢… í™•ì •í•œ í›„, dApp ê´€ë¦¬ìëŠ” í•´ë‹¹ PCRê³¼ public keyë¡œ enclaveë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

```sh
# ì„ íƒì ìœ¼ë¡œ
$ sui client switch --env testnet # ë˜ëŠ” ì ë‹¹í•œ ë„¤íŠ¸ì›Œí¬
$ sui client faucet
$ sui client gas
# Enclave packageë¥¼ ë°°í¬í•œë‹¤.
$ cd move/enclave
$ sui move build
$ sui client publish

# ENCLAVE_PACKAGE_IDë¥¼ publish ì¶œë ¥ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¡œ ê¸°ë¡
$ ENCLAVE_PACKAGE_ID=0x3b009f952e11f0fa0612d0a8e07461fb69edc355d732e5d6e39267b1b4fd7138

# dApp ë¡œì§ì„ ë°°í¬í•œë‹¤.
$ cd ../<APP>
$ sui move build
$ sui client publish

#  publish ì¶œë ¥ì—ì„œ CAP_OBJECT_ID (owned object of type Cap), ENCLAVE_CONFIG_OBJECT_ID (shared object), APP_PACKAGE_ID (pë‚ ì”¨ ëª¨ë“ˆì„ í¬í•¨í•˜ëŠ” package)ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ê¸°ë¡í•œë‹¤
$ CAP_OBJECT_ID=0xb232d20245ba2d624d1c1628c4fc062bd1d3249601385476d9736fc60c897d2b
$ ENCLAVE_CONFIG_OBJECT_ID=0x9a50017ab37090ef4b5704eb24201c88b2e4bbad2aad1d4e69ecf1bdfbae9ccb
$ APP_PACKAGE_ID=0x097b551dec72f0c47e32e5f8114d0d12a98ab31762d21adff295f6d95d353154

# ë°°í¬ëœ enclave URLì„ ê¸°ë¡í•œë‹¤(ì˜ˆ: http://<PUBLIC_IP>:3000)
$ ENCLAVE_URL=<DEPLOYED_URL>

# dApp ìƒì„±ì— ì‚¬ìš©í•œ ëª¨ë“ˆ ì´ë¦„ê³¼ OTW ì´ë¦„ìœ¼ë¡œ, Move ì½”ë“œ `fun init`ì— ì •ì˜ë˜ì–´ ìˆë‹¤.
$ MODULE_NAME=weather
$ OTW_NAME=WEATHER

# ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ê°€ ì±„ì›Œì¡ŒëŠ”ì§€ í™•ì¸í•œë‹¤
$ echo $APP_PACKAGE_ID
$ echo $ENCLAVE_PACKAGE_ID
$ echo $CAP_OBJECT_ID
$ echo $ENCLAVE_CONFIG_OBJECT_ID
$ echo 0x$PCR0
$ echo 0x$PCR1
$ echo 0x$PCR2
$ echo $MODULE_NAME
$ echo $OTW_NAME
$ echo $ENCLAVE_URL

# =======
# ì´í›„ì— ì´ì–´ì§€ëŠ” ë‘ ë‹¨ê³„(update pcrs, register enclave)ëŠ” enclave ì„œë²„ê°€ ì—…ë°ì´íŠ¸ë˜ë©´ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
# =======

# ì´ëŠ” enclave capê³¼ ë¹Œë“œëœ PCRë¡œ ì˜¨ì²´ì¸ì—ì„œ update_pcrsë¥¼ í˜¸ì¶œí•˜ë©°, Rust ì„œë²„ ì½”ë“œê°€ ì—…ë°ì´íŠ¸ë˜ë©´ PCRì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë° ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
$ sui client call --function update_pcrs --module enclave --package $ENCLAVE_PACKAGE_ID --type-args "$APP_PACKAGE_ID::$MODULE_NAME::$OTW_NAME" --args $ENCLAVE_CONFIG_OBJECT_ID $CAP_OBJECT_ID 0x$PCR0 0x$PCR1 0x$PCR2

# ì„ íƒ ì‚¬í•­ìœ¼ë¡œ, ì›í•˜ëŠ” ì´ë¦„ì„ ë¶€ì—¬í•œë‹¤
$ sui client call --function update_name --module enclave --package $ENCLAVE_PACKAGE_ID --type-args "$APP_PACKAGE_ID::$MODULE_NAME::$OTW_NAME" --args $ENCLAVE_CONFIG_OBJECT_ID $CAP_OBJECT_ID "weather enclave, updated 2025-05-13"

# ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” enclave URLì—ì„œ get_attestation ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ê³  ì´ë¥¼ ì‚¬ìš©í•´ ì˜¨ì²´ì¸ì—ì„œ register_enclaveë¥¼ í˜¸ì¶œí•˜ì—¬ public keyë¥¼ ë“±ë¡í•˜ë©°, ê·¸ ê²°ê³¼ë¡œ enclave objectê°€ ìƒì„±ëœë‹¤.
ëœë‹¤
$ sh ../../register_enclave.sh $ENCLAVE_PACKAGE_ID $APP_PACKAGE_ID $ENCLAVE_CONFIG_OBJECT_ID $ENCLAVE_URL $MODULE_NAME $OTW_NAME

# register ì¶œë ¥ì—ì„œ ìƒì„±ëœ shared object ENCLAVE_OBJECT_IDë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ê¸°ë¡í•œë‹¤
$ ENCLAVE_OBJECT_ID=0x1c9ccfc0f391f5e679e1f9f7d53c7fa455bf977e0f6dc71222990401f359c42a
```

PCR ê°’ì´ í¬í•¨ëœ [example enclave config object](https://testnet.suivision.xyz/object/0x58a6a284aaea8c8e71151e4ae0de2350ae877f0bd94adc2b2d0266cf23b6b41d)ë¥¼ SuiScanì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>Enclaveì˜ ë“±ë¡ëœ public keyê°€ í¬í•¨ëœ [example enclave object](https://testnet.suivision.xyz/object/0xe0e70df5347560a1b43e5954267cadd1386a562095cb4285f2581bf2974c838d)ë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### Artifacts for Twitter example

```sh
$ cd nautilus/
$ make ENCLAVE_APP=twitter-example
$ cat out/nitro.pcrs
```

<details> <summary>Output</summary> </details>

```sh
968f1266150cf8c4d62c9692b9f9b8fd6889d9331019d323f67a6ae6ab88b9378ad23f49f58c349526b9fdd5865da879 PCR0
968f1266150cf8c4d62c9692b9f9b8fd6889d9331019d323f67a6ae6ab88b9378ad23f49f58c349526b9fdd5865da879 PCR1
21b9efbc184807662e966d34f390821309eeac6802309798826296bf3e8bec7c10edb30948c90ba67310f7b964fc500a PCR2
```



```sh
# ì´í›„ enclave ë“±ë¡ ì‹œ ì‚¬ìš©í•  í™˜ê²½ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•œë‹¤.
$ PCR0=968f1266150cf8c4d62c9692b9f9b8fd6889d9331019d323f67a6ae6ab88b9378ad23f49f58c349526b9fdd5865da879
$ PCR1=968f1266150cf8c4d62c9692b9f9b8fd6889d9331019d323f67a6ae6ab88b9378ad23f49f58c349526b9fdd5865da879
$ PCR2=21b9efbc184807662e966d34f390821309eeac6802309798826296bf3e8bec7c10edb30948c90ba67310f7b964fc500a

$ MODULE_NAME=twitter
$ OTW_NAME=TWITTER

# ë“±ë¡í•œ enclaveë¡œ ë°”ê¾¼ë‹¤
$ ENCLAVE_PACKAGE_ID=0xcca410b231d0acfa92c7709d490ab2f15fb5619be719ee0786099ffc3f6c9ab8
$ APP_PACKAGE_ID=0x652875162b566bb04187c76f93215e56c28aa05487393056279e331598ba4978
$ CAP_OBJECT_ID=0x44f3b57aa3870762ad334424cccb7f4c785cac007baab7e987c6d6a43c6aa100
$ ENCLAVE_CONFIG_OBJECT_ID=0xe33641a2dae5eb4acad3859e603ec4e25641af05f837c85058645c7d8d9d831a
$ ENCLAVE_OBJECT_ID=0x53db077721140910697668f9b2ee80fbecd104ac076d60fc1fb49ae57cd96c0d

# ìì‹ ì˜ enclave IPë¡œ ë°”ê¾¼ë‹¤
$ ENCLAVE_URL=http://<PUBLIC_IP>:3000
```

PCR ê°’ì´ í¬í•¨ëœ [example enclave config object](https://testnet.suivision.xyz/object/0xe33641a2dae5eb4acad3859e603ec4e25641af05f837c85058645c7d8d9d831a) ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br>ë“±ë¡ëœ enclaveì˜ public keyê°€ í¬í•¨ëœ  [example enclave object](https://testnet.suivision.xyz/object/0x53db077721140910697668f9b2ee80fbecd104ac076d60fc1fb49ae57cd96c0d)ë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

Twitter ì˜ˆì œì˜ frontend ì½”ë“œëŠ”  [in this repository](https://github.com/MystenLabs/nautilus-twitter/tree/main/frontend)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### Enclave management

ì´ í…œí”Œë¦¿ì€ ê´€ë¦¬ìê°€ PCRì„ ì •ì˜í•˜ëŠ” í•˜ë‚˜ì˜ `EnclaveConfig` ì™€ ì—°ê²°ëœ ì—¬ëŸ¬ `Enclave` objectë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.<br>ê° `Enclave` objectëŠ” ê³ ìœ í•œ public keyë¥¼ ê°€ì§„ íŠ¹ì • enclave ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë‚˜íƒ€ë‚´ë©°, `EnclaveConfig`ëŠ” PCR ê°’ê³¼ ê´€ë ¨ ë²„ì „ì„ ì¶”ì í•œë‹¤.<br>ìµœì‹  `config_version`ìœ¼ë¡œ ëª¨ë“  ìƒˆë¡œìš´ `Enclave` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë“±ë¡í•˜ì—¬ ì¼ê´€ì„±ì„ ë³´ì¥í•  ìˆ˜ ìˆë‹¤.

ì´ ì„¤ê³„ëŠ” ê´€ë¦¬ìê°€ ì„œë¡œ ë‹¤ë¥¸ public keyë¥¼ ê°€ì§„ ë™ì¼í•œ enclaveì˜ ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.<br>`Enclave` objectë¥¼ ìƒì„±í•  ë•Œ `config_version`ì„ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì„¤ì •í•œë‹¤.<br>ê´€ë¦¬ìëŠ” ìì‹ ì˜ `Enclave` objectë¥¼ ë“±ë¡í•˜ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.

### Update PCRs

ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ë°°í¬ìëŠ” `EnclaveCap`ì„ ë³´ìœ í•˜ë©°, Nautilus ì„œë²„ ì½”ë“œê°€ ìˆ˜ì •ëœ ê²½ìš° PCRê³¼ enclaveì˜ public keyë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤.<br>`make ENCLAVE_APP=<APP> && cat out/nitro.pcrs`ë¥¼ ì‚¬ìš©í•´ ìƒˆë¡œìš´ PCRì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.<br>PCRì„ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ enclaveë¥¼ ë‹¤ì‹œ ë“±ë¡í•˜ë ¤ë©´ ì´ì „ ì„¹ì…˜ì˜ ë‹¨ê³„ë¥¼ ì¬ì‚¬ìš©í•œë‹¤.

## Using the verified computation in Move

ì´ì œ ê³„ì‚°ì„ ìœ„í•´ enclaveì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” í”„ëŸ°íŠ¸ì—”ë“œ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³ , ê²°ê³¼ ë°ì´í„°ë¥¼ Move ì»¨íŠ¸ë™íŠ¸ë¡œ ì „ì†¡í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br>ë‚ ì”¨ ì˜ˆì œì˜ ê²½ìš°, íŠ¹ì • ìœ„ì¹˜ì˜ ë‚ ì”¨ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ enclaveì— ìš”ì²­í•  ìˆ˜ ìˆë‹¤:

```sh
$ curl -H 'Content-Type: application/json' -d '{"payload": { "location": "San Francisco"}}' -X POST http://<PUBLIC_IP>:3000/process_data
```

<details></details>

<summary>Output</summary>

```json
{
  "response":
    {
      "intent":0,
      "timestamp_ms":1744683300000,
      "data":
        {
          "location":"San Francisco",
          "temperature":13
        }
    },
  "signature":"77b6d8be225440d00f3d6eb52e91076a8927cebfb520e58c19daf31ecf06b3798ec3d3ce9630a9eceee46d24f057794a60dd781657cb06d952269cfc5ae19500"
}
```



ê·¸ëŸ° ë‹¤ìŒ enclave ì‘ë‹µì˜ ê°’ `signature`, `timestamp`, `location`, and `temperature`ë¥¼ ì‚¬ìš©í•˜ì—¬ Move ì»¨íŠ¸ë™íŠ¸ì—ì„œ `update_weather`ë¥¼ í˜¸ì¶œí•œë‹¤.<br>ì´ ì˜ˆì œì—ì„œëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•´ í˜¸ì¶œì„ ì‹œì—°í•˜ì§€ë§Œ, dApp í”„ëŸ°íŠ¸ì—”ë“œì— í†µí•©í•´ì•¼ í•œë‹¤.

```sh
$ sh ../../update_weather.sh \
    $APP_PACKAGE_ID \
    $MODULE_NAME \
    $OTW_NAME \
    $ENCLAVE_OBJECT_ID \
    "77b6d8be225440d00f3d6eb52e91076a8927cebfb520e58c19daf31ecf06b3798ec3d3ce9630a9eceee46d24f057794a60dd781657cb06d952269cfc5ae19500" \
    1744683300000 \
    "San Francisco" \
    13
```

ë„¤íŠ¸ì›Œí¬ ìŠ¤ìºë„ˆì—ì„œ [created weather NFT](https://testnet.suivision.xyz/object/0xa78e166630c0ed004b3115b474fed15d71f27fc80b68e37d451494c6e815931e)ì˜ˆì œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### Signing payload

Moveì—ì„œì˜ ì„œëª… í˜ì´ë¡œë“œëŠ” Binary Canonical Serialization(BCS)ì„ ì‚¬ìš©í•´ êµ¬ì„±ëœë‹¤.<br>ì´ëŠ” ì„œëª…ì„ ìƒì„±í•  ë•Œ enclaveì˜ Rust ì½”ë“œì—ì„œ ì§€ì •ëœ êµ¬ì¡°ì™€ ì¼ì¹˜í•´ì•¼ í•˜ë©°, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ `enclave.move`ì—ì„œ ì„œëª… ê²€ì¦ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆë‹¤.

ì¼ê´€ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ Moveì™€ Rust ëª¨ë‘ì—ì„œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë‹¤.<br>`src/nautilus-server/src/app.rs`ì˜ `test_serde()`ì™€ `move/enclave/enclave.move`ì˜ ì˜ˆì œë¥¼ ì°¸ì¡°í•œë‹¤.

## FAQs

ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì€ ë‹¤ìŒ ì„¹ì…˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### Why did Sui choose AWS Nitro Enclaves initially?

ì‚¬ìš© ê°€ëŠ¥í•œ TEE ê³µê¸‰ìëŠ” ë§ì§€ë§Œ, AWS Nitro EnclavesëŠ” ì„±ìˆ™ë„ì™€ ì¬í˜„ ê°€ëŠ¥í•œ ë¹Œë“œì— ëŒ€í•œ ì§€ì› ë•Œë¬¸ì— ì´ˆê¸° ì§€ì› ëŒ€ìƒìœ¼ë¡œ ì„ íƒë˜ì—ˆë‹¤.<br>ì¶”ê°€ TEE ê³µê¸‰ìì— ëŒ€í•œ ì§€ì›ì„ í–¥í›„ ê³ ë ¤í•  ìˆ˜ ìˆë‹¤.

<importcontent source="contact-nautilus.mdx" mode="snippet"></importcontent>

### Where is the root of trust of AWS?

ì´ëŠ” the Sui frameworkì˜ ì¼ë¶€ë¡œ ì €ì¥ë˜ë©° AWS attestation ë¬¸ì„œë¥¼ ê²€ì¦í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.[AWS](https://docs.aws.amazon.com/enclaves/latest/user/verify-root.html#validation-process)ì— ì„¤ëª…ëœ ë‹¨ê³„ë¥¼ ë”°ë¼ í•´ì‹œë¥¼ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.

```sh
$ curl https://raw.githubusercontent.com/MystenLabs/sui/refs/heads/main/crates/sui-types/src/nitro_root_certificate.pem -o cert_sui.pem
$ sha256sum cert_sui.pem

6eb9688305e4bbca67f44b59c29a0661ae930f09b5945b5d1d9ae01125c8d6c0

$ curl https://aws-nitro-enclaves.amazonaws.com/AWS_NitroEnclaves_Root-G1.zip -o cert_aws.zip
$ unzip cert_aws.zip
$ sha256sum root.pem

6eb9688305e4bbca67f44b59c29a0661ae930f09b5945b5d1d9ae01125c8d6c0 # check it matches from the one downloaded from the Sui repo
```
